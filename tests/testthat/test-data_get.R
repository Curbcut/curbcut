test_that("data_get.q5  works", {
  vars <- vars_build(var_left = "housing_tenant_2016", df = "city_CSD")
  expect_equal(
    data_get(vars = vars, df = "city_CSD"),
    structure(list(ID = c(
      "2466023_1", "2466023_10", "2466023_11",
      "2466023_12", "2466023_13", "2466023_14", "2466023_15", "2466023_16",
      "2466023_17", "2466023_18", "2466023_19", "2466023_2", "2466023_3",
      "2466023_4", "2466023_5", "2466023_6", "2466023_7", "2466023_8",
      "2466023_9"
    ), var_left = c(
      0.46742263374493, 0.610044647068096,
      0.651200250895949, 0.656917518455931, 0.733780149049553, 0.696069554148255,
      0.51332284596523, 0.72316366338869, 0.557524549983557, 0.303032954866295,
      0.630312052165921, 0.602790444013453, 0.726831240833312, 0.724940544023304,
      0.658173994915436, 0.368605152415204, 0.574326516633886, 0.715550496848715,
      0.260430093546149
    ), var_left_q3 = c(
      1L, 2L, 2L, 2L, 3L, 3L, 1L,
      3L, 1L, 1L, 2L, 2L, 3L, 3L, 2L, 1L, 1L, 3L, 1L
    ), var_left_q5 = c(
      2,
      3, 4, 4, 4, 4, 3, 4, 3, 1, 3, 3, 4, 4, 4, 2, 3, 4, 1
    ), group = c(
      2,
      3, 4, 4, 4, 4, 3, 4, 3, 1, 3, 3, 4, 4, 4, 2, 3, 4, 1
    )), row.names = c(
      NA,
      -19L
    ), class = "data.frame")
  )
})

test_that("data_get.bivar works", {
  vars <- vars_build(
    var_left = c("canale_2016"),
    var_right = c("housing_tenant_2016"),
    df = "city_CSD"
  )
  expect_equal(
    data_get(
      vars = vars,
      df = "city_CSD"
    ),
    structure(list(ID = c(
      "2466023_1", "2466023_10", "2466023_11",
      "2466023_12", "2466023_13", "2466023_14", "2466023_15", "2466023_16",
      "2466023_17", "2466023_18", "2466023_19", "2466023_2", "2466023_3",
      "2466023_4", "2466023_5", "2466023_6", "2466023_7", "2466023_8",
      "2466023_9"
    ), var_left = c(
      5.17897305268505, 2.11892077731932,
      1.83288634324764, 3.27143959167789, 3.53889643143718, 5.47655712498528,
      1.44583734402671, 4.09610887086589, 1.23184112579966, 0.280705113872664,
      3.33974763426294, 0.9369605306685, 10.5726657372762, 9.98992229030665,
      4.3287537809745, 0.107247029635278, 0.772162564097198, 1.76299711169787,
      -0.55000190305368
    ), var_left_q3 = c(
      3L, 2L, 2L, 2L, 2L, 3L, 1L,
      3L, 1L, 1L, 2L, 1L, 3L, 3L, 3L, 1L, 1L, 2L, 1L
    ), var_left_q5 = c(
      3,
      2, 2, 2, 2, 3, 1, 3, 1, 1, 2, 1, 5, 5, 3, 1, 1, 2, 1
    ), var_right = c(
      0.46742263374493,
      0.610044647068096, 0.651200250895949, 0.656917518455931, 0.733780149049553,
      0.696069554148255, 0.51332284596523, 0.72316366338869, 0.557524549983557,
      0.303032954866295, 0.630312052165921, 0.602790444013453, 0.726831240833312,
      0.724940544023304, 0.658173994915436, 0.368605152415204, 0.574326516633886,
      0.715550496848715, 0.260430093546149
    ), var_right_q3 = c(
      1L, 2L,
      2L, 2L, 3L, 3L, 1L, 3L, 1L, 1L, 2L, 2L, 3L, 3L, 2L, 1L, 1L, 3L,
      1L
    ), var_right_q5 = c(
      2, 3, 4, 4, 4, 4, 3, 4, 3, 1, 3, 3, 4,
      4, 4, 2, 3, 4, 1
    ), group = c(
      "3 - 1", "2 - 2", "2 - 2", "2 - 2",
      "2 - 3", "3 - 3", "1 - 1", "3 - 3", "1 - 1", "1 - 1", "2 - 2",
      "1 - 2", "3 - 3", "3 - 3", "3 - 2", "1 - 1", "1 - 1", "2 - 3",
      "1 - 1"
    )), row.names = c(NA, -19L), class = "data.frame")
  )
})

test_that("data_get.delta works", {
  vars <- vars_build(
    var_left = c("housing_tenant_1996", "housing_tenant_2016"),
    var_right = c(" "),
    df = "city_CSD"
  )
  expect_equal(
    data_get(
      vars = vars,
      df = "city_CSD"
    ),
    structure(list(ID = c(
      "2466023_1", "2466023_10", "2466023_11",
      "2466023_12", "2466023_13", "2466023_14", "2466023_15", "2466023_16",
      "2466023_17", "2466023_18", "2466023_19", "2466023_2", "2466023_3",
      "2466023_4", "2466023_5", "2466023_6", "2466023_7", "2466023_8",
      "2466023_9"
    ), var_left_1 = c(
      0.572401615941982, 0.638890782191534,
      0.66692437236146, 0.719984454422041, 0.778795633151838, 0.768924884331389,
      0.616747290875743, 0.74976362201309, 0.59542153407969, 0.333488775863741,
      0.740459339897514, 0.644969867953243, 0.855479996814116, 0.814831629993318,
      0.747292324803015, 0.386649388821556, 0.631171353828745, 0.722045805300192,
      0.288601264314785
    ), var_left_2 = c(
      0.46742263374493, 0.610044647068096,
      0.651200250895949, 0.656917518455931, 0.733780149049553, 0.696069554148255,
      0.51332284596523, 0.72316366338869, 0.557524549983557, 0.303032954866295,
      0.630312052165921, 0.602790444013453, 0.726831240833312, 0.724940544023304,
      0.658173994915436, 0.368605152415204, 0.574326516633886, 0.715550496848715,
      0.260430093546149
    ), var_left = c(
      -0.183400918643971, -0.0451503385672425,
      -0.0235770682811217, -0.0875948578872251, -0.0578014079510229,
      -0.0947496064540622, -0.167693391508305, -0.035477793058271,
      -0.0636473186256316, -0.0913248756830413, -0.148755349276624,
      -0.0653975108537121, -0.150381956866207, -0.110318601611908,
      -0.119254978178815, -0.0466682139634246, -0.0900624479391093,
      -0.00899570138597625, -0.0976127766990957
    ), var_left_q5 = c(
      1,
      2, 2, 2, 2, 2, 1, 2, 2, 2, 1, 2, 1, 1, 1, 2, 2, 3, 2
    ), group = c(
      "1",
      "2", "2", "2", "2", "2", "1", "2", "2", "2", "1", "2", "1", "1",
      "1", "2", "2", "3", "2"
    )), row.names = c(NA, -19L), class = "data.frame")
  )
})

test_that("data_get.delta_bivar works", {
  vars <- vars_build(
    var_left = c("housing_tenant_1996", "housing_tenant_2016"),
    var_right = c("housing_value_1996", "housing_value_2016"),
    df = "city_CSD"
  )
  expect_equal(
    data_get(
      vars = vars,
      df = "city_CSD"
    ),
    structure(list(ID = c(
      "2466023_1", "2466023_10", "2466023_11",
      "2466023_12", "2466023_13", "2466023_14", "2466023_15", "2466023_16",
      "2466023_17", "2466023_18", "2466023_19", "2466023_2", "2466023_3",
      "2466023_4", "2466023_5", "2466023_6", "2466023_7", "2466023_8",
      "2466023_9"
    ), var_left_1 = c(
      0.572401615941982, 0.638890782191534,
      0.66692437236146, 0.719984454422041, 0.778795633151838, 0.768924884331389,
      0.616747290875743, 0.74976362201309, 0.59542153407969, 0.333488775863741,
      0.740459339897514, 0.644969867953243, 0.855479996814116, 0.814831629993318,
      0.747292324803015, 0.386649388821556, 0.631171353828745, 0.722045805300192,
      0.288601264314785
    ), var_left_2 = c(
      0.46742263374493, 0.610044647068096,
      0.651200250895949, 0.656917518455931, 0.733780149049553, 0.696069554148255,
      0.51332284596523, 0.72316366338869, 0.557524549983557, 0.303032954866295,
      0.630312052165921, 0.602790444013453, 0.726831240833312, 0.724940544023304,
      0.658173994915436, 0.368605152415204, 0.574326516633886, 0.715550496848715,
      0.260430093546149
    ), var_left = c(
      -0.183400918643971, -0.0451503385672425,
      -0.0235770682811217, -0.0875948578872251, -0.0578014079510229,
      -0.0947496064540622, -0.167693391508305, -0.035477793058271,
      -0.0636473186256316, -0.0913248756830413, -0.148755349276624,
      -0.0653975108537121, -0.150381956866207, -0.110318601611908,
      -0.119254978178815, -0.0466682139634246, -0.0900624479391093,
      -0.00899570138597625, -0.0976127766990957
    ), var_right_1 = c(
      277881.04793295,
      166472.071737858, 214915.86495235, 130221.889064496, 183471.190987008,
      128569.184116456, 166149.792707589, 134292.304399989, 136970.882669593,
      120555.173196769, 142083.153050628, 149374.28996941, 175878.260255933,
      125432.956484204, 115201.024100716, 121468.354902487, 127332.406808424,
      138531.60839236, 149657.389908838
    ), var_right_2 = c(
      892959.639367602,
      449960.422532744, 529856.388011505, 349067.288665284, 539146.011390052,
      421380.225717989, 463173.683018497, 389742.370651438, 366001.083035271,
      359867.677215822, 458856.420419839, 430659.954640925, 519783.907343534,
      476558.036645852, 382916.014518199, 306417.371993799, 365668.066568573,
      343146.153277511, 452174.623194567
    ), var_right = c(
      2.21346002546768,
      1.70291838045539, 1.46541309609219, 1.68055770940628, 1.93858675299181,
      2.27745896976611, 1.78768739623798, 1.90219437660846, 1.67210866938891,
      1.98508697447972, 2.22949210070203, 1.88309289857792, 1.95536188831502,
      2.79930482389504, 2.32389418850505, 1.52261070169087, 1.87175963868124,
      1.47702424926465, 2.02139856555032
    ), var_left_q3 = c(
      1L, 3L,
      3L, 2L, 3L, 2L, 1L, 3L, 2L, 2L, 1L, 2L, 1L, 1L, 1L, 3L, 2L, 3L,
      1L
    ), var_right_q3 = c(
      3L, 1L, 1L, 1L, 2L, 3L, 1L, 2L, 1L, 2L,
      3L, 2L, 2L, 3L, 3L, 1L, 2L, 1L, 3L
    ), group = c(
      "1 - 3", "3 - 1",
      "3 - 1", "2 - 1", "3 - 2", "2 - 3", "1 - 1", "3 - 2", "2 - 1",
      "2 - 2", "1 - 3", "2 - 2", "1 - 2", "1 - 3", "1 - 3", "3 - 1",
      "2 - 2", "3 - 1", "1 - 3"
    )), row.names = c(NA, -19L), class = "data.frame")
  )
})

test_that("data_get.bivar_ldelta_rq3 works", {
  vars <- vars_build(
    var_left = c("housing_tenant_1996", "housing_tenant_2016"),
    var_right = c("canale_2016"),
    df = "city_CSD"
  )
  expect_equal(
    data_get(
      vars = vars,
      df = "city_CSD"
    ),
    structure(list(ID = c(
      "2466023_1", "2466023_10", "2466023_11",
      "2466023_12", "2466023_13", "2466023_14", "2466023_15", "2466023_16",
      "2466023_17", "2466023_18", "2466023_19", "2466023_2", "2466023_3",
      "2466023_4", "2466023_5", "2466023_6", "2466023_7", "2466023_8",
      "2466023_9"
    ), var_left_1 = c(
      0.572401615941982, 0.638890782191534,
      0.66692437236146, 0.719984454422041, 0.778795633151838, 0.768924884331389,
      0.616747290875743, 0.74976362201309, 0.59542153407969, 0.333488775863741,
      0.740459339897514, 0.644969867953243, 0.855479996814116, 0.814831629993318,
      0.747292324803015, 0.386649388821556, 0.631171353828745, 0.722045805300192,
      0.288601264314785
    ), var_left_2 = c(
      0.46742263374493, 0.610044647068096,
      0.651200250895949, 0.656917518455931, 0.733780149049553, 0.696069554148255,
      0.51332284596523, 0.72316366338869, 0.557524549983557, 0.303032954866295,
      0.630312052165921, 0.602790444013453, 0.726831240833312, 0.724940544023304,
      0.658173994915436, 0.368605152415204, 0.574326516633886, 0.715550496848715,
      0.260430093546149
    ), var_left = c(
      -0.183400918643971, -0.0451503385672425,
      -0.0235770682811217, -0.0875948578872251, -0.0578014079510229,
      -0.0947496064540622, -0.167693391508305, -0.035477793058271,
      -0.0636473186256316, -0.0913248756830413, -0.148755349276624,
      -0.0653975108537121, -0.150381956866207, -0.110318601611908,
      -0.119254978178815, -0.0466682139634246, -0.0900624479391093,
      -0.00899570138597625, -0.0976127766990957
    ), var_left_q3 = c(
      1L,
      3L, 3L, 2L, 3L, 2L, 1L, 3L, 2L, 2L, 1L, 2L, 1L, 1L, 1L, 3L, 2L,
      3L, 1L
    ), var_right = c(
      5.17897305268505, 2.11892077731932, 1.83288634324764,
      3.27143959167789, 3.53889643143718, 5.47655712498528, 1.44583734402671,
      4.09610887086589, 1.23184112579966, 0.280705113872664, 3.33974763426294,
      0.9369605306685, 10.5726657372762, 9.98992229030665, 4.3287537809745,
      0.107247029635278, 0.772162564097198, 1.76299711169787, -0.55000190305368
    ), var_right_q3 = c(
      3L, 2L, 2L, 2L, 2L, 3L, 1L, 3L, 1L, 1L, 2L,
      1L, 3L, 3L, 3L, 1L, 1L, 2L, 1L
    ), group = c(
      "1 - 3", "3 - 2",
      "3 - 2", "2 - 2", "3 - 2", "2 - 3", "1 - 1", "3 - 3", "2 - 1",
      "2 - 1", "1 - 2", "2 - 1", "1 - 3", "1 - 3", "1 - 3", "3 - 1",
      "2 - 1", "3 - 2", "1 - 1"
    )), row.names = c(NA, -19L), class = "data.frame")
  )
})
